---
title: "LD 链接器脚本语法"
date: "2026-02-19"
toc: true
draft: true
---


## 基本概念

- VMA（虚拟内存地址）：程序运行时的地址，即堆栈上的地址。
- LMA（加载内存地址）：程序数据存储的地址，比如已初始化的全局变量的值在 FLASH 中存储的地址就是 LMA ，当这个值被加载到 SRAM 中栈上的地址就是 VMA 。


## 简单示例


以下脚本仅包含一个 *`SECTIONS`* 命令：

```c
SECTIONS
{
    . = 0x10000;
    .text : { *(.text) }
    . = 0x8000000;
    .data : { *(.data) }
    .bss  : { *(.bss)  }
    _end_of_bss = .;
}
```

*`SECTIONS`* 命令用于描述输出文件的内存布局，该脚本输出的内存布局如下图：

{{< img src="simple-map.svg" >}}


脚本中 `.` 表示当前位置计数器。它从 *`0x0`* 开始，可以直接修改，也可以通过添加输出节、常量等间接修改。因此，如果你在 .bss 节之后读取位置计数器的值，它的值将是 *`0x8000000`* 加上你添加的节的大小。



## 命令

### 设置入口点

**`ENTRY(符号)`**

有多种方式可以设置入口点。链接器将按顺序尝试以下每种方法，并在其中一种成功时停止：

- 命令行 *`-e`* 选项。
- 链接器脚本中的 *`ENTRY(符号)`* 命令。
- 符号 *`start`* 的值，如果已定义。
- *`.text`* 节的第一个字节的地址，如果存在。
- 地址 *`0`* 。

### 文件处理命令

**`INCLUDE 文件名`**

用于在当前的链接器脚本中包含另一个文件的内容，会搜索当前目录以及 *`-L`* 选项指定的目录。

**`INPUT(文件1, 文件2, ...)`**

指定输入文件。如 *`INPUT(main.o, utils.o, math.o)`* 等同于命令行中的 *`ld main.o utils.o math.o`* 。

**`GROUP(文件1, 文件2, ...)`**

类似于 *`INPUT`* 命令，不同之处（没太搞懂，*`INPUT`* 是单次搜索，*`GROUP`* 会多次搜索直到没有未解析的引用？）。

**`OUTPUT(文件名)`**

用于指定输出文件的名称。如 *`OUTPUT(target.elf)`* 等同于命令行中的 *`-o target.elf`* 。

**`SEARCH_DIR(路径)`**

指定输入文件的搜索路径。如 *`SEARCH_DIR(path)`* 等同于命令行中的 *`-L path`* 。

**`STARTUP(文件名)`**

用于指定第一个输入文件。*`STARTUP`* 命令指定的文件会被链接器最先处理（该文件中的代码会被放在输出文件的最前面、符号会最先被解析）。


### 目标文件格式处理命令





## 参考链接

- [Linker Scripts](https://home.cs.colorado.edu/~main/cs1300/doc/gnu/ld_3.html)
